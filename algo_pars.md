# Алгоритм получения имени справочника из файла конфигурации 1C

## Введение
Файлы конфигурации 1C Enterprise (.cf) содержат метаданные, включая справочники. Для извлечения имени справочника из бинарного формата используется многошаговый процесс парсинга.

## Общий рабочего процесса

### 1. Распаковка файла конфигурации
```
С помощью команды -unpack извлекаются блоки метаданных из .cf файла в файловую структуру.
```

### 2. Извлечение строки метаданных
```
Функция ParseToString() читает содержимое блоков метаданных и возвращает их в виде текстовой строки,
разделенной секциями вида "--- block_name ---"
```

### 3. Парсинг и организация по типам
```
Функция ParseToStringWithFiles() анализирует строку метаданных и сохраняет содержимое
в организованную структуру директорий по типам метаданных.
```

## Алгоритм получения имени справочника

### Этап 1: Определение типа объекта
```
Для каждого блока метаданных проверяется принадлежность к типу "Справочники":

- GUID корневого типа справочников: cf4abea6-37b2-11d4-940f-008048da11f9
- Имя типа: "Справочники"

Если блок принадлежит к данному типу, запускается алгоритм извлечения имени.
```

### Этап 2: Парсинг содержимого справочника
```
Из содержимого блока справочника извлекается имя по следующему алгоритму:

1. GUID справочника ищется в начале содержимого
2. После GUID следует паттерн: },\"имя_справочника\",
3. Регулярное выражение: expected_guid + "\\},\\\"(.*?)\\\","
```

### Пример содержимого справочника:
```
36b34b4a-30fc-40f3-be9d-59e7d39f8e95},"Справочник1","Справочник1",...
```

### Реализация поиска имени:
```cpp
std::string extract_object_name(const std::string& content, const std::string& expected_guid) {
    std::string pattern_str = expected_guid + "\\},\\\"([^\\\"]+)\\\",";
    std::regex name_pattern(pattern_str);

    std::smatch match;
    if (std::regex_search(content, match, name_pattern)) {
        if (match.size() > 1) {
            return match[1].str();
        }
    }
    return "";
}
```

### Этап 3: Создание структуры директорий
```
Для каждого справочника создается иерархическая структура:

base_dir/Справочники/Имя_Справочника/GUID_справочника.txt

Например:
/save_output/Справочники/Справочник1/36b34b4a-30fc-40f3-be9d-59e7d39f8e95.txt
```

## Используемые GUID для типов объектов

| GUID | Тип объекта | Каталог |
|------|-------------|---------|
| cf4abea6-37b2-11d4-940f-008048da11f9 | Справочники | Справочники |
| 9cd510ce-abfc-11d4-9434-004095e12fc7 | Языки | Языки |
| ... | ... | ... |

## Ключевые функции

- `ParseToString()` - извлекает метаданные в строку
- `ParseToStringWithFiles()` - организует и сохраняет файлы
- `extract_object_name()` - извлекает имя из содержимого
- `find_guids()` - ищет GUID в тексте

## Примечания

- Алгоритм работает корректно только для конфигураций в формате 1C:Enterprise 8.3.16+
- Для каждого GUID справочника создается отдельный файл .txt
- Имена директорий очищаются от недопустимых символов файловой системы
